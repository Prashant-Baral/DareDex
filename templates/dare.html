{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<style>
    /* hero section */
    .hero-section {
        background: linear-gradient(135deg, rgb(10, 30, 23) 0%, rgb(25, 94, 72) 50%, rgb(45, 128, 102) 100%);
        color: white;
        padding: 80px 0;
    }

    /* form section  */
    .form-section {
        background-color: #f8f9fa;
        padding: 80px 0;
    }

    .form-card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .form-header {
        background: linear-gradient(135deg, rgb(34, 98, 78) 20%, #1eb679 100%);
        color: white;
        padding: 30px;
        text-align: center;
    }

    .form-body {
        padding: 40px;
    }

    .form-control,
    .form-select {
        border-radius: 10px;
        border: 2px solid #e9ecef;
        padding: 12px 15px;
        font-size: 16px;
        transition: all 0.3s ease;
    }

    .form-control:focus,
    .form-select:focus {
        border-color: rgb(34, 98, 78);
        box-shadow: 0 0 0 0.2rem rgba(34, 98, 78, 0.25);
    }

    .form-control.is-invalid {
        border-color: #dc3545;
    }

    .form-control.is-valid {
        border-color: #28a745;
    }

    .form-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 8px;
    }

    /* buttons */
    .btn-custom {
        background: linear-gradient(135deg, rgb(34, 98, 78) 20%, #1eb679 100%);
        border: none;
        color: white;
        padding: 12px 30px;
        border-radius: 25px;
        font-weight: 500;
        transition: all 0.3s ease;
        width: 100%;
    }

    .btn-custom:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(34, 98, 78, 0.4);
        color: white;
    }

    .btn-custom:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .btn-danger-custom {
        background: linear-gradient(45deg, #dc3545, #c82333);
        border: none;
        color: white;
        padding: 8px 20px;
        border-radius: 20px;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .btn-danger-custom:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        color: white;
    }

    /* difficulty badge */
    .difficulty-badge {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .difficulty-easy {
        background: #d4edda;
        color: #155724;
    }

    .difficulty-medium {
        background: #fff3cd;
        color: #856404;
    }

    .difficulty-hard {
        background: #f8d7da;
        color: #721c24;
    }

    .difficulty-extreme {
        background: #d1ecf1;
        color: #0c5460;
    }

    /* tips section */
    .tips-section {
        background: linear-gradient(135deg, rgb(10, 30, 23) 0%, rgb(25, 94, 72) 100%);
        color: white;
        padding: 60px 0;
        margin-top: 80px;
        position: relative;
        overflow: hidden;
    }

    .tips-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.2;
        z-index: 1;
    }

    .tips-content {
        position: relative;
        z-index: 2;
    }

    .tip-card {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 15px;
        padding: 25px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        height: 100%;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .tip-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    .character-count {
        font-size: 12px;
        color: #6c757d;
        text-align: right;
        margin-top: 5px;
    }

    .character-count.warning {
        color: #dc3545;
        font-weight: 600;
    }

    .preview-section {
        background: #e9ecef;
        border-radius: 15px;
        padding: 30px;
        margin-top: 30px;
        display: none;
    }

    .preview-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        border: 1px solid #dee2e6;
    }

    .alert-custom {
        border-radius: 10px;
        border: none;
        padding: 15px 20px;
    }

    .form-step {
        display: none;
    }

    .form-step.active {
        display: block;
    }

    .step-indicator {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
    }

    .step-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #e9ecef;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #6c757d;
        position: relative;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .step-circle:hover {
        background: #d1ecf1;
        transform: scale(1.05);
    }

    .step-circle.active {
        background: #10867f;
        color: white;
    }

    .step-circle.completed {
        background: #28a745;
        color: white;
    }

    .step-circle.disabled {
        cursor: not-allowed;
        opacity: 0.6;
    }

    .step-circle.disabled:hover {
        transform: none;
        background: #e9ecef;
    }

    .step-line {
        width: 50px;
        height: 2px;
        background: #e9ecef;
    }

    .step-line.completed {
        background: #28a745;
    }

    .guidelines-modal .modal-content {
        border-radius: 15px;
        border: none;
    }

    .guidelines-modal .modal-header {
        background: linear-gradient(135deg, rgb(34, 98, 78) 0%, #1eb679 100%);
        color: white;
        border-bottom: none;
    }

    @media (max-width: 768px) {
        .form-body {
            padding: 20px;
        }

        .step-indicator {
            gap: 10px;
        }

        .step-line {
            width: 30px;
        }
    }
</style>
{% endblock %}

{% block body %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h1 class="display-4 fw-bold mb-3">
                    <i class="fas fa-plus-circle"></i> Create Your Dare
                </h1>
                <p class="lead mb-4">
                    Share your creative dare ideas with the college community. Make it fun, safe, and memorable!
                </p>
                <button class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#guidelinesModal">
                    <i class="fas fa-info-circle me-2"></i>Read Guidelines
                </button>
            </div>
        </div>
    </div>
</section>

<!-- Create Dare Form -->
<section class="form-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">


                <div class="card form-card">
                    <div class="form-header">
                        <h3 class="mb-0"><i class="fas fa-edit"></i> Dare Details</h3>
                    </div>
                    <div class="form-body">

                        <!-- Step Indicator -->
                        <div class="step-indicator">
                            <div class="step-circle active" id="step1Circle" onclick="goToStep(1)">1</div>
                            <div class="step-line" id="step1Line"></div>
                            <div class="step-circle disabled" id="step2Circle" onclick="goToStep(2)">2</div>
                        </div>

                        <!-- Alert Messages -->
                        <div id="alertContainer"></div>

                        <form id="createDareForm" method="POST" action="/create-dare/" enctype="multipart/form-data"
                            novalidate>
                            {% csrf_token %}
                            <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

                            <!-- Step 1: All Main Details -->
                            <div class="form-step active" id="step1">

                                <!-- Dare Title -->
                                <div class="mb-4">
                                    <label for="title" class="form-label">
                                        <i class="fas fa-heading text-primary me-2"></i>Dare Title *
                                    </label>
                                    <input type="text" class="form-control" id="title" name="title"
                                        placeholder="Enter a catchy title for your dare" maxlength="200" required>
                                    <div class="character-count">
                                        <span id="titleCount">0</span>/200 characters
                                    </div>
                                    <div class="invalid-feedback" id="titleError"></div>
                                </div>

                                <!-- Category -->
                                <div class="mb-4">
                                    <label for="category" class="form-label">
                                        <i class="fas fa-tags text-primary me-2"></i>Category *
                                    </label>
                                    <select class="form-select" id="category" name="category" required>
                                        <option value="">Select a category</option>
                                        <option value="social">Social & Interaction</option>
                                        <option value="creative">Creative & Artistic</option>
                                        <option value="physical">Physical Challenge</option>
                                        <option value="mental">Mental Challenge</option>
                                        <option value="food">Food & Eating</option>
                                        <option value="academic">Academic</option>
                                        <option value="adventure">Adventure</option>
                                        <option value="comedy">Comedy & Fun</option>
                                        <option value="skill">Skill Based</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <div class="invalid-feedback" id="categoryError"></div>
                                </div>

                                <!-- Difficulty Level -->
                                <div class="mb-4">
                                    <label for="difficulty" class="form-label">
                                        <i class="fas fa-chart-line text-primary me-2"></i>Difficulty Level *
                                    </label>
                                    <select class="form-select" id="difficulty" name="level" required>
                                        <option value="">Select difficulty</option>
                                        <option value="easy">Easy - Anyone can do it</option>
                                        <option value="medium">Medium - Requires some courage</option>
                                        <option value="hard">Hard - For the brave ones</option>
                                        <option value="extreme">Extreme - Only for daredevils</option>
                                    </select>
                                    <div class="mt-2" id="difficultyPreview"></div>
                                    <div class="invalid-feedback" id="difficultyError"></div>
                                </div>

                                <!-- Description -->
                                <div class="mb-4">
                                    <label for="description" class="form-label">
                                        <i class="fas fa-align-left text-primary me-2"></i>Dare Description *
                                    </label>
                                    <textarea class="form-control" id="description" name="dare" rows="4"
                                        placeholder="Describe your dare in detail. Include instructions, rules, and any special requirements..."
                                        maxlength="1000" required></textarea>
                                    <div class="character-count">
                                        <span id="descriptionCount">0</span>/1000 characters
                                    </div>
                                    <div class="invalid-feedback" id="descriptionError"></div>
                                </div>

                                <!-- Duration -->
                                <div class="mb-4">
                                    <label for="duration" class="form-label">
                                        <i class="fas fa-clock text-primary me-2"></i>Estimated Duration
                                    </label>
                                    <select class="form-select" id="duration" name="duration">
                                        <option value="">Select duration</option>
                                        <option value="5_minutes">5 minutes</option>
                                        <option value="15_minutes">15 minutes</option>
                                        <option value="30_minutes">30 minutes</option>
                                        <option value="1_hour">1 hour</option>
                                        <option value="2_hours">2-3 hours</option>
                                        <option value="half_day">Half day</option>
                                        <option value="full_day">Full day</option>
                                        <option value="multiple_days">Multiple days</option>
                                    </select>
                                </div>

                                <!-- Safety Instructions (optional) -->
                                <div class="mb-4">
                                    <label for="safety_instructions" class="form-label">
                                        <i class="fas fa-list-check text-primary me-2"></i>Safety Instructions
                                    </label>
                                    <textarea class="form-control" id="safety_instructions" name="safety" rows="3"
                                        placeholder="List any safety instructions."></textarea>
                                </div>

                                <div class="d-flex justify-content-end">
                                    <button type="button" class="btn btn-custom" onclick="nextStep()">
                                        Next Step <i class="fas fa-arrow-right ms-2"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Step 2: Final Details -->
                            <div class="form-step" id="step2">
                                <h5 class="mb-4"><i class="fas fa-user text-primary me-2"></i> Final Details</h5>

                                <!-- Uploader Name -->
                                <div class="mb-4">
                                    <label for="uploaderName" class="form-label">
                                        <i class="fas fa-user-edit text-primary me-2"></i>Your Name *
                                    </label>
                                    <input type="text" class="form-control" id="uploaderName" name="name"
                                        placeholder="Enter your name" required>
                                    <div class="invalid-feedback" id="uploaderNameError"></div>
                                </div>

                                <!-- Safety Warning -->
                                <div class="mb-4">
                                    <div class="alert alert-warning alert-custom" role="alert">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <strong>Safety First!</strong> Please ensure your dare is safe and doesn't
                                        encourage harmful behavior.
                                        All dares are reviewed before being published.
                                    </div>
                                </div>

                                <!-- Terms Agreement -->
                                <div class="mb-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="agreeTerms"
                                            name="agreeTerms" required>
                                        <label class="form-check-label" for="agreeTerms">
                                            I agree that this dare is safe, appropriate, and follows the
                                            <a href="#" class="text-decoration-none" data-bs-toggle="modal"
                                                data-bs-target="#guidelinesModal">community guidelines</a>
                                        </label>
                                        <div class="invalid-feedback" id="termsError"></div>
                                    </div>
                                </div>

                                <div class="row mt-4 g-3">
                                    <div class="col-md-4">
                                        <button type="button" class="btn btn-custom w-100" onclick="prevStep()">
                                            <i class="fas fa-arrow-left me-2"></i>Previous
                                        </button>
                                    </div>
                                    <div class="col-md-4">
                                        <button type="button" class="btn btn-custom w-100" onclick="previewDare()">
                                            <i class="fas fa-eye me-2"></i>Preview
                                        </button>
                                    </div>
                                    <div class="col-md-4">
                                        <button type="submit" class="btn btn-custom w-100" id="submitBtn">
                                            <i class="fas fa-paper-plane me-2"></i>Submit Dare
                                        </button>
                                    </div>
                                </div>

                            </div>
                        </form>

                    </div>
                </div>

                <!-- Preview Section -->
                <div id="previewSection" class="preview-section" style="display:none;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5><i class="fas fa-eye me-2"></i>Dare Preview</h5>
                        <button type="button" class="btn btn-danger-custom btn-sm" onclick="hidePreview()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="preview-card" id="previewCard">
                        <!-- Preview content will be generated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Success Modal -->
<div class="modal fade" id="submissionSuccessModal" tabindex="-1" aria-labelledby="submissionSuccessModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-4 shadow">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="submissionSuccessModalLabel">🎉 Success!</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <p>Your dare has been submitted successfully and is pending review.</p>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-success" data-bs-dismiss="modal">Okay</button>
            </div>
        </div>
    </div>
</div>


<!-- Guidelines Modal -->
<div class="modal fade guidelines-modal" id="guidelinesModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-shield-alt me-2"></i>Community Guidelines</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-success"><i class="fas fa-check-circle me-2"></i>What Makes a Great Dare
                        </h6>
                        <ul class="list-unstyled">
                            <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Creative and original
                                ideas</li>
                            <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Safe and harmless
                                activities</li>
                            <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Inclusive for all
                                students</li>
                            <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Clear and detailed
                                instructions</li>
                            <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Appropriate language and
                                content</li>
                            <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Respect for others'
                                boundaries</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-danger"><i class="fas fa-times-circle me-2"></i>What's Not Allowed</h6>
                        <ul class="list-unstyled">
                            <li class="mb-2"><i class="fas fa-times text-danger me-2"></i>Dangerous or harmful
                                activities</li>
                            <li class="mb-2"><i class="fas fa-times text-danger me-2"></i>Illegal activities</li>
                            <li class="mb-2"><i class="fas fa-times text-danger me-2"></i>Bullying or harassment
                            </li>
                            <li class="mb-2"><i class="fas fa-times text-danger me-2"></i>Inappropriate or offensive
                                content</li>
                            <li class="mb-2"><i class="fas fa-times text-danger me-2"></i>Sharing personal
                                information</li>
                            <li class="mb-2"><i class="fas fa-times text-danger me-2"></i>Discrimination of any kind
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="alert alert-info mt-3">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Review Process:</strong> All dares are reviewed by our moderation team before being
                    published to ensure they meet our community standards.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-custom" data-bs-dismiss="modal">Got it!</button>
            </div>
        </div>
    </div>
</div>

<!-- Tips Section -->
<section class="tips-section">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-5">
                <h2><i class="fas fa-lightbulb me-2"></i>Tips for Creating Great Dares</h2>
                <p class="lead">Make your dares memorable and fun for everyone!</p>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="tip-card">
                    <div class="text-center mb-3">
                        <i class="fas fa-users fa-3x"></i>
                    </div>
                    <h5>Be Inclusive</h5>
                    <p>Create dares that everyone can participate in, regardless of their background or comfort
                        level.</p>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="tip-card">
                    <div class="text-center mb-3">
                        <i class="fas fa-shield-alt fa-3x"></i>
                    </div>
                    <h5>Safety First</h5>
                    <p>Always prioritize safety and well-being. Avoid dares that could cause harm or distress.</p>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="tip-card">
                    <div class="text-center mb-3">
                        <i class="fas fa-star fa-3x"></i>
                    </div>
                    <h5>Be Creative</h5>
                    <p>Think outside the box! The most memorable dares are often the most creative ones.</p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Global variables
    let currentStep = 1;
    const totalSteps = 2;

    // Character counter functionality
    function setupCharacterCounters() {
        const titleInput = document.getElementById('title');
        const descriptionInput = document.getElementById('description');
        const titleCount = document.getElementById('titleCount');
        const descriptionCount = document.getElementById('descriptionCount');

        titleInput.addEventListener('input', function () {
            const count = this.value.length;
            titleCount.textContent = count;
            titleCount.parentElement.classList.toggle('warning', count > 180);
            checkStep1Completion();
        });

        descriptionInput.addEventListener('input', function () {
            const count = this.value.length;
            descriptionCount.textContent = count;
            descriptionCount.parentElement.classList.toggle('warning', count > 900);
            checkStep1Completion();
        });

        // Add listeners to other step 1 fields
        document.getElementById('category').addEventListener('change', checkStep1Completion);
        document.getElementById('difficulty').addEventListener('change', checkStep1Completion);

        // Add listeners to step 2 fields
        document.getElementById('uploaderName').addEventListener('input', checkFormCompletion);
        document.getElementById('agreeTerms').addEventListener('change', checkFormCompletion);
    }

    // Check if step 1 is complete to enable step 2
    function checkStep1Completion() {
        const title = document.getElementById('title').value.trim();
        const category = document.getElementById('category').value;
        const difficulty = document.getElementById('difficulty').value;
        const description = document.getElementById('description').value.trim();

        const step1Complete = title && category && difficulty && description;
        const step2Circle = document.getElementById('step2Circle');

        if (step1Complete) {
            step2Circle.classList.remove('disabled');
        } else {
            step2Circle.classList.add('disabled');
        }
    }

    // Check if entire form is complete to enable submission
    function checkFormCompletion() {
        const title = document.getElementById('title').value.trim();
        const category = document.getElementById('category').value;
        const difficulty = document.getElementById('difficulty').value;
        const description = document.getElementById('description').value.trim();
        const uploaderName = document.getElementById('uploaderName').value.trim();
        const agreeTerms = document.getElementById('agreeTerms').checked;

        const formComplete = title && category && difficulty && description && uploaderName && agreeTerms;
        const submitBtn = document.getElementById('submitBtn');

        submitBtn.disabled = !formComplete;
    }

    // Navigate to specific step (clickable step indicators)
    function goToStep(stepNumber) {
        if (stepNumber === 2) {
            const step2Circle = document.getElementById('step2Circle');
            if (step2Circle.classList.contains('disabled')) {
                showAlert('Please complete Step 1 before proceeding to Step 2.', 'warning');
                return;
            }
        }

        // Hide current step
        document.getElementById(`step${currentStep}`).classList.remove('active');
        document.getElementById(`step${currentStep}Circle`).classList.remove('active');

        // Show target step
        currentStep = stepNumber;
        document.getElementById(`step${currentStep}`).classList.add('active');
        document.getElementById(`step${currentStep}Circle`).classList.add('active');

        // Update step completion status
        if (stepNumber === 2) {
            document.getElementById('step1Circle').classList.add('completed');
            document.getElementById('step1Line').classList.add('completed');
        } else {
            document.getElementById('step1Circle').classList.remove('completed');
            document.getElementById('step1Line').classList.remove('completed');
        }

        // Smooth scroll to form
        document.querySelector('.form-card').scrollIntoView({ behavior: 'smooth' });
    }

    // Step navigation
    function nextStep() {
        if (validateCurrentStep()) {
            if (currentStep < totalSteps) {
                goToStep(currentStep + 1);
            }
        }
    }

    function prevStep() {
        if (currentStep > 1) {
            goToStep(currentStep - 1);
        }
    }

    // Form validation
    function validateCurrentStep() {
        let isValid = true;

        if (currentStep === 1) {
            // Validate Step 1 fields
            const title = document.getElementById('title');
            const category = document.getElementById('category');
            const difficulty = document.getElementById('difficulty');
            const description = document.getElementById('description');

            if (!title.value.trim()) {
                showFieldError('title', 'Title is required');
                isValid = false;
            } else {
                clearFieldError('title');
            }

            if (!category.value) {
                showFieldError('category', 'Category is required');
                isValid = false;
            } else {
                clearFieldError('category');
            }

            if (!difficulty.value) {
                showFieldError('difficulty', 'Difficulty level is required');
                isValid = false;
            } else {
                clearFieldError('difficulty');
            }

            if (!description.value.trim()) {
                showFieldError('description', 'Description is required');
                isValid = false;
            } else {
                clearFieldError('description');
            }
        } else if (currentStep === 2) {
            // Validate Step 2 fields
            const uploaderName = document.getElementById('uploaderName');
            const agreeTerms = document.getElementById('agreeTerms');

            if (!uploaderName.value.trim()) {
                showFieldError('uploaderName', 'Your name is required');
                isValid = false;
            } else {
                clearFieldError('uploaderName');
            }

            if (!agreeTerms.checked) {
                showFieldError('agreeTerms', 'You must agree to the community guidelines');
                isValid = false;
            } else {
                clearFieldError('agreeTerms');
            }
        }

        return isValid;
    }

    // Field error handling
    function showFieldError(fieldId, message) {
        const field = document.getElementById(fieldId);
        const errorDiv = document.getElementById(fieldId + 'Error');

        field.classList.add('is-invalid');
        field.classList.remove('is-valid');

        if (errorDiv) {
            errorDiv.textContent = message;
        }
    }

    function clearFieldError(fieldId) {
        const field = document.getElementById(fieldId);
        const errorDiv = document.getElementById(fieldId + 'Error');

        field.classList.remove('is-invalid');
        field.classList.add('is-valid');

        if (errorDiv) {
            errorDiv.textContent = '';
        }
    }

    // Alert system
    function showAlert(message, type = 'info') {
        const alertContainer = document.getElementById('alertContainer');
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-custom alert-dismissible fade show`;
        alertDiv.innerHTML = `
            <i class="fas fa-${type === 'danger' ? 'exclamation-triangle' : type === 'warning' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'info-circle'} me-2"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

        alertContainer.appendChild(alertDiv);

        // Auto dismiss after 5 seconds
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.remove();
            }
        }, 5000);
    }

    // Difficulty level preview
    function updateDifficultyPreview() {
        const difficulty = document.getElementById('difficulty').value;
        const previewDiv = document.getElementById('difficultyPreview');

        if (difficulty) {
            const badges = {
                'easy': '<span class="difficulty-badge difficulty-easy">Easy</span>',
                'medium': '<span class="difficulty-badge difficulty-medium">Medium</span>',
                'hard': '<span class="difficulty-badge difficulty-hard">Hard</span>',
                'extreme': '<span class="difficulty-badge difficulty-extreme">Extreme</span>'
            };
            previewDiv.innerHTML = badges[difficulty] || '';
        } else {
            previewDiv.innerHTML = '';
        }
    }

    // Dare preview functionality
    function previewDare() {
        if (!validateCurrentStep()) {
            return;
        }

        const title = document.getElementById('title').value;
        const category = document.getElementById('category').value;
        const difficulty = document.getElementById('difficulty').value;
        const description = document.getElementById('description').value;
        const duration = document.getElementById('duration').value;
        const safetyInstructions = document.getElementById('safety_instructions').value;
        const uploaderName = document.getElementById('uploaderName').value;

        const categoryLabels = {
            'social': 'Social & Interaction',
            'creative': 'Creative & Artistic',
            'physical': 'Physical Challenge',
            'mental': 'Mental Challenge',
            'food': 'Food & Eating',
            'academic': 'Academic',
            'adventure': 'Adventure',
            'comedy': 'Comedy & Fun',
            'skill': 'Skill Based',
            'other': 'Other'
        };

        const difficultyLabels = {
            'easy': 'Easy - Anyone can do it',
            'medium': 'Medium - Requires some courage',
            'hard': 'Hard - For the brave ones',
            'extreme': 'Extreme - Only for daredevils'
        };

        const durationLabels = {
            '5_minutes': '5 minutes',
            '15_minutes': '15 minutes',
            '30_minutes': '30 minutes',
            '1_hour': '1 hour',
            '2_hours': '2-3 hours',
            'half_day': 'Half day',
            'full_day': 'Full day',
            'multiple_days': 'Multiple days'
        };

        const difficultyBadges = {
            'easy': '<span class="difficulty-badge difficulty-easy">Easy</span>',
            'medium': '<span class="difficulty-badge difficulty-medium">Medium</span>',
            'hard': '<span class="difficulty-badge difficulty-hard">Hard</span>',
            'extreme': '<span class="difficulty-badge difficulty-extreme">Extreme</span>'
        };

        const previewCard = document.getElementById('previewCard');
        previewCard.innerHTML = `
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                    <h4 class="mb-1">${title}</h4>
                    <small class="text-muted">by ${uploaderName}</small>
                </div>
                <div class="text-end">
                    ${difficultyBadges[difficulty]}
                </div>
            </div>
            
            <div class="mb-3">
                <span class="badge bg-secondary me-2">
                    <i class="fas fa-tag me-1"></i>${categoryLabels[category]}
                </span>
                ${duration ? `<span class="badge bg-info">
                    <i class="fas fa-clock me-1"></i>${durationLabels[duration]}
                </span>` : ''}
            </div>
            
            <div class="mb-3">
                <h6><i class="fas fa-align-left me-2"></i>Description</h6>
                <p class="text-muted">${description}</p>
            </div>
            
            ${safetyInstructions ? `
            <div class="mb-3">
                <h6><i class="fas fa-shield-alt me-2"></i>Safety Instructions</h6>
                <p class="text-muted">${safetyInstructions}</p>
            </div>
            ` : ''}
            
            <div class="text-muted small">
                <i class="fas fa-info-circle me-1"></i>
                This is how your dare will appear to other users.
            </div>
        `;

        document.getElementById('previewSection').style.display = 'block';
        document.getElementById('previewSection').scrollIntoView({ behavior: 'smooth' });
    }

    function hidePreview() {
        document.getElementById('previewSection').style.display = 'none';
    }


    // Initialize everything when DOM is loaded
    document.addEventListener('DOMContentLoaded', function () {
        setupCharacterCounters();

        // Show difficulty badge live
        document.getElementById('difficulty').addEventListener('change', updateDifficultyPreview);

        // Override form submit
        document.getElementById('createDareForm').addEventListener('submit', function (event) {
            if (!this.checkValidity()) {
                // Let HTML5 handle showing errors
                return;
            }

            event.preventDefault(); // stop actual submission so we can show modal

            // Show success modal
            const successModal = new bootstrap.Modal(document.getElementById('submissionSuccessModal'));
            successModal.show();

            // OPTIONAL: submit after delay if you still want to save to backend
            setTimeout(() => {
                this.submit();  // resume actual submission after modal shows
            }, 2000);
        });

        checkStep1Completion();
        checkFormCompletion();
    });


    // Keyboard navigation
    document.addEventListener('keydown', function (event) {
        if (event.key === 'Enter' && event.ctrlKey) {
            event.preventDefault();
            if (currentStep === 1) {
                nextStep();
            } else if (currentStep === 2) {
                const form = document.getElementById('createDareForm');
                if (form.checkValidity()) {
                    form.dispatchEvent(new Event('submit'));
                }
            }
        }
    });
</script>
{% endblock %}